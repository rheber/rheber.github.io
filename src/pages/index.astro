---
import { SITE_DESCRIPTION } from "../consts";
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import BlogPost from "../layouts/BlogPost.astro";

// https://stackoverflow.com/a/22015930
const zip = (a: any[], b: any[]): [any, any][] => a.map((k, i) => [k, b[i]]);

const recentPosts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
).slice(0, 3);
const recentPostRenders = await Promise.all(recentPosts.map(post => post.render()));
const recentPostContent = recentPostRenders.map(render => render.Content);
const recentPostsWithContent = zip(recentPosts, recentPostContent);
---

<BaseLayout title={SITE_DESCRIPTION}>
	{recentPostsWithContent.map((item) => {
		const Content = item[1];
		return (
			<BlogPost {...item[0].data}>
				<Content />
			</BlogPost>
		);
	})}
</BaseLayout>
